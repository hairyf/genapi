# Configuration

genapi defines API generation behavior through configuration files. Configuration files support TypeScript, JavaScript, or JSON formats.

## Configuration File

Create one of the following configuration files in your project root:

- `genapi.config.ts`
- `genapi.config.js`
- `genapi.config.json`

## Basic Configuration

```ts
import { defineConfig } from '@genapi/core'
import { axios } from '@genapi/presets'

export default defineConfig({
  preset: axios.ts,
  input: 'http://example.com/api-docs',
  output: {
    main: 'src/api/index.ts',
    type: 'src/api/index.type.ts',
  },
})
```

## Configuration Options

### preset

Preset configuration that defines how APIs are generated. genapi provides multiple presets:

- `axios.ts` / `axios.js` - Use axios client
- `fetch.ts` / `fetch.js` - Use native fetch API
- `ky.ts` / `ky.js` - Use ky client
- `got.ts` / `got.js` - Use got client
- `ofetch.ts` / `ofetch.js` - Use ofetch client
- `uni.ts` / `uni.js` - Use uni-app network request library

### input

Input source, which can be:

- **URL string**: Directly pass in the API documentation URL
  ```ts
  input: 'http://example.com/api-docs'
  ```

- **Object**: Contains `uri` or `json` field
  ```ts
  input: {
    uri: 'http://example.com/api-docs'
  }
  // or
  input: {
    json: { /* OpenAPI JSON object */ }
  }
  ```

### parser

Parser type for input source. Determines how the input data is parsed:

- `'swagger'` (default): Supports OpenAPI 2.0/3.x and Swagger 2.0 formats
- `'wpapi'`: Supports WordPress REST API format, automatically converts to Swagger

**Example with WordPress REST API:**

```ts
export default defineConfig({
  preset: axios.ts,
  parser: 'wpapi', // or 'swagger'
  input: 'https://your-wordpress-site.com/wp-json',
  output: {
    main: 'src/api/index.ts',
  },
})
```

### output

Output configuration, defines the generated file paths:

```ts
output: {
  main: 'src/api/index.ts',      // Main file path
  type: 'src/api/index.type.ts', // Type definition file path (optional)
}
```

### meta

Metadata configuration for customizing generated code:

```ts
meta: {
  // API base URL
  baseURL: 'import.meta.env.VITE_APP_BASE_API',
  // Custom response type transformation
  responseType: 'T extends { data?: infer V } ? V : void',
}
```

## Multiple Services

For projects with multiple services, use the `servers` configuration:

```ts
export default defineConfig({
  // All servers inherit the upper layer configuration
  meta: {
    baseURL: 'https://example.com/api',
  },
  servers: [
    {
      input: 'http://service1/api-docs',
      output: { main: 'src/api/service1.ts' }
    },
    {
      input: 'http://service2/api-docs',
      output: { main: 'src/api/service2.ts' }
    },
  ]
})
```

## Patch - Static Patches

Make exact-match modifications to operations and type definitions:

```ts
export default defineConfig({
  preset: axios.ts,
  input: 'https://petstore.swagger.io/v2/swagger.json',
  patch: {
    operations: {
      // Rename function
      postUpdateUserUsingPOST: 'updateUserInfo',
      // Modify parameters and return type
      getUserUsingGET: {
        name: 'getUser',
        parameters: [{ name: 'id', type: 'string', required: true }],
        responseType: 'UserResponse'
      }
    },
    definitions: {
      // Rename type
      UserDto: 'User',
      // Override type (creates type alias)
      SessionDto: {
        name: 'Session',
        type: '{ name: string, age: number }'
      }
    }
  }
})
```

## Transform - Global Transformations

Batch transform operations and type definitions via functions:

```ts
export default defineConfig({
  preset: axios.ts,
  input: 'https://petstore.swagger.io/v2/swagger.json',
  transform: {
    operation: name => `api_${name}`, // Batch add prefix
    definition: name => name.endsWith('Dto') ? name.slice(0, -3) : name
  },
  patch: {
    // transform executes first, patch executes after
    operations: { api_getUser: 'fetchUser' }
  }
})
```

## MockJS - Mock Data Generation

Automatically generate mock methods for each API function (requires `better-mock`):

```ts
export default defineConfig({
  preset: axios.ts,
  input: 'https://petstore.swagger.io/v2/swagger.json',
  mockjs: true,
})
```

Usage:

```ts
import { getUser } from './api'

const mockUser = getUser.mock() // Returns mock data conforming to type definitions
```
